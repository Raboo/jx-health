buildPack: none
dockerRegistryOwner: jenkinsxio
pipelineConfig:
  pipelines:
    pullRequest:
      pipeline:
        stages:
          - agent:
              image: golang:1.15
            name: ci
            options:
              containerOptions:
                resources:
                  limits:
                    cpu: 3
                    memory: 6072Mi
                  requests:
                    cpu: 2
                    memory: 4048Mi
            steps:
              - name: test
                command: make test
              - name: lint
                command: make lint
                image: golangci/golangci-lint:v1.31

    release:
      pipeline:
        stages:
        - agent:
            image: gcr.io/jenkinsxio/builder-go
          name: chart
          options:
            containerOptions:
              resources:
                limits:
                  cpu: 3
                  memory: 6072Mi
                requests:
                  cpu: 2
                  memory: 4048Mi
          steps:
          - name: release-binary
            command: make release
            image: golang:1.15
          - name: changelog
            command: jx step changelog --verbose --header-file=hack/changelog-header.md --version=$VERSION --rev=$PULL_BASE_SHA --output-markdown=changelog.md --update-release=false
          - name: upload-binaries
            command: make goreleaser
            image: gcr.io/jenkinsxio/step-go-releaser
          - command: ./promote.sh
            dir: /workspace/source
            name: promote-release
